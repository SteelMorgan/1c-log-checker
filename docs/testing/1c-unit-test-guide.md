# Руководство по генерации логов через unit-тесты в 1C

## Phase 3.2: Генерация логов через unit-тесты

### Подготовка

1. **Убедитесь, что logcfg.xml создан** (Phase 3.1 завершена)
   - Файл должен быть в: `configs/techlog/logcfg.xml`
   - 1C должна быть настроена читать его через `conf.cfg` (см. `docs/techlog/configuration-setup.md`)

2. **Проверьте путь к логам**
   - Базовый путь: значение из `TECHLOG_DIRS` в `deploy/docker/.env`
   - Полный путь: `<TECHLOG_DIRS>/<cluster_guid>/<infobase_guid>`
   - Пример: `D:\My Projects\FrameWork 1C\1c-log-checker\tech_logs\b0881663-f2a7-4195-b7a2-f7f8e6c3a8f3\d723aefd-7992-420d-b5f9-a273fd4146be`

### Создание unit-теста

1. **Откройте конфигуратор 1C**

2. **Создайте объект для тестирования:**
   - Справочник "ТестыТехнологическогоЖурнала" или
   - Обычный модуль объекта

3. **Скопируйте код из `tests/1c/UnitTest_GenerateTechLog.bsl`**

4. **Сохраните конфигурацию**

### Запуск теста

#### Вариант 1: Через конфигуратор

1. Откройте конфигуратор
2. Перейдите в режим отладки (F5)
3. В консоли запросов выполните:
   ```bsl
   Объект = Справочники.ТестыТехнологическогоЖурнала.СоздатьЭлемент();
   Объект.Тест_ГенерацияНесколькихСобытий();
   ```

#### Вариант 2: Через YaXUnit (если установлен)

1. Запустите YaXUnit
2. Выберите тест `Тест_ГенерацияНесколькихСобытий`
3. Запустите тест

#### Вариант 3: Через внешнее соединение

1. Подключитесь к базе через внешнее соединение
2. Выполните код теста в консоли запросов

### Проверка создания логов

После выполнения теста:

1. **Подождите 5-10 секунд** (1C пишет логи асинхронно)

2. **Запустите скрипт проверки:**
   ```powershell
   powershell -ExecutionPolicy Bypass -File scripts/phase3_2_check_logs.ps1
   ```

3. **Или проверьте вручную:**
   - Откройте каталог: `<TECHLOG_DIRS>/<cluster_guid>/<infobase_guid>`
   - Должны быть подкаталоги: `rphost_XXXX`, `1cv8c_XXXX`, etc.
   - Внутри должны быть файлы `*.log`

### Ожидаемый результат

- ✅ Созданы каталоги: `rphost_XXXX/`, `1cv8c_XXXX/`, etc.
- ✅ Созданы файлы `.log` в JSON формате
- ✅ В логах присутствуют события `EXCP` (исключения)
- ✅ В логах присутствуют события `QERR` (ошибки запросов)
- ✅ Timestamp корректные (соответствуют времени выполнения теста)

### Устранение проблем

**Логи не создаются:**
- Проверьте, что `logcfg.xml` находится в правильном месте
- Проверьте, что `conf.cfg` настроен правильно (см. `docs/techlog/configuration-setup.md`)
- Проверьте права доступа 1C на запись в каталог логов
- Проверьте, что процесс 1C (rphost, 1cv8c) запущен

**Логи создаются, но пустые:**
- Проверьте фильтры событий в `logcfg.xml` (должны быть EXCP и QERR)
- Убедитесь, что тест действительно вызвал исключения/ошибки запросов

**Логи в text формате вместо JSON:**
- Проверьте, что в `logcfg.xml` указано `format="json"`
- Перезапустите процесс 1C после изменения конфигурации


