# Проблема: BoltDB файл заблокирован

## Симптомы

При запуске парсера возникает ошибка:
```
failed to create offset store: failed to open boltdb: timeout
```

## Причина

Файл `offsets/parser.db` заблокирован другим процессом парсера, который не завершился корректно (например, был убит принудительно через `Stop-Process -Force`).

## Решение

### Вариант 1: Найти и остановить процесс (рекомендуется)

```powershell
# Найти процесс парсера
Get-Process | Where-Object { $_.ProcessName -like "*go*" -or $_.Path -like "*go-build*" } | Format-Table ProcessName,Id,Path

# Остановить процесс по ID
Stop-Process -Id <PID> -Force

# Подождать 2-3 секунды и удалить файл
Start-Sleep -Seconds 3
Remove-Item "offsets\parser.db" -Force -ErrorAction SilentlyContinue
```

### Вариант 2: Удалить файл вручную

Если процесс уже завершился, но файл остался заблокированным (редкий случай):

```powershell
# Удалить файл
Remove-Item "offsets\parser.db" -Force -ErrorAction SilentlyContinue
```

**Внимание:** При удалении файла теряются сохраненные offset'ы, и парсер начнет читать логи с начала.

### Вариант 3: Перезагрузить компьютер

В крайнем случае, если файл заблокирован системой.

## Профилактика

1. **Всегда останавливайте парсер корректно:**
   - Используйте `Ctrl+C` в терминале
   - Или отправьте сигнал `SIGTERM` процессу

2. **Не используйте `Stop-Process -Force`** без необходимости - это убивает процесс без вызова cleanup функций

3. **Проверяйте процессы перед запуском:**
   ```powershell
   Get-Process | Where-Object { $_.ProcessName -eq "go" -or $_.Path -like "*parser*" }
   ```

## Технические детали

BoltDB использует файловую блокировку на уровне ОС. Когда процесс открывает базу данных, файл блокируется до вызова `db.Close()`. Если процесс завершается принудительно, блокировка может остаться до перезагрузки системы или завершения процесса, держащего файл.




