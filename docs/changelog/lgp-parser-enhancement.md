# –£–ª—É—á—à–µ–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞ LGP —Ñ–∞–π–ª–æ–≤

**–î–∞—Ç–∞:** 2025-11-13  
**–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞:** OneSTools.EventLog (C# –≤–µ—Ä—Å–∏—è)

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –î–æ–ø–æ–ª–Ω–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö `EventLogRecord`

**–§–∞–π–ª:** `internal/domain/event.go`

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è:**
- `TransactionDateTime time.Time` - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `TransactionNumber int64` - –ù–æ–º–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–∏–∑ hex)
- `Connection string` - –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∞, –Ω–µ —Ç–æ–ª—å–∫–æ ID)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `ConnectionID` —Ç–µ–ø–µ—Ä—å –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç C# –≤–µ—Ä—Å–∏–∏ `EventLogItem`

---

### 2. –ü–µ—Ä–µ–ø–∏—Å–∞–Ω –ø–∞—Ä—Å–µ—Ä `parseRecord()`

**–§–∞–π–ª:** `internal/logreader/eventlog/lgp_parser.go`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏–∑ C# –≤–µ—Ä—Å–∏–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π:
  1. timestamp (YYYYMMDDHHMMSS)
  2. transaction_status (U, C, R, N)
  3. transaction {date_hex, number_hex}
  4. user_id
  5. computer_id
  6. application
  7. connection
  8. event_id
  9. severity (I, E, W, N) - —ç—Ç–æ level!
  10. comment
  11. metadata
  12. data
  13. data_presentation
  14. server
  15. main_port
  16. add_port
  17. session

**–ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ Transaction status —Ç–µ–ø–µ—Ä—å –ø–∞—Ä—Å–∏—Ç—Å—è –∏–∑ –ø–æ–ª—è [1], –∞ –Ω–µ –∏–∑ level
- ‚úÖ Severity (level) –ø–∞—Ä—Å–∏—Ç—Å—è –∏–∑ –ø–æ–ª—è [8]
- ‚úÖ Transaction date –∏ number –ø–∞—Ä—Å—è—Ç—Å—è –∏–∑ hex –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ –í—Å–µ –ø–æ–ª—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ C# –≤–µ—Ä—Å–∏–∏

---

### 3. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –º–∞–ø–ø–∏–Ω–≥–∞ –∑–Ω–∞—á–µ–Ω–∏–π

**–§–∞–π–ª:** `internal/logreader/eventlog/lgp_parser.go`

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

1. **`getTransactionPresentation(code string) string`**
   - –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (U‚Üí–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞, C‚Üí–û—Ç–º–µ–Ω–µ–Ω–∞, R‚Üí–ù–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, N‚Üí–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

2. **`getSeverityPresentation(code string) string`**
   - –ú–∞–ø–ø–∏–Ω–≥ —É—Ä–æ–≤–Ω—è —Å–æ–±—ã—Ç–∏—è (I‚Üí–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, E‚Üí–û—à–∏–±–∫–∞, W‚Üí–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, N‚Üí–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ)

3. **`getApplicationPresentation(code string) string`**
   - –ú–∞–ø–ø–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (1CV8‚Üí–¢–æ–ª—Å—Ç—ã–π –∫–ª–∏–µ–Ω—Ç, 1CV8C‚Üí–¢–æ–Ω–∫–∏–π –∫–ª–∏–µ–Ω—Ç, WebClient‚Üí–í–µ–±-–∫–ª–∏–µ–Ω—Ç, –∏ —Ç.–¥.)
   - –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ C# –≤–µ—Ä—Å–∏–∏ (13 —Ç–∏–ø–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)

4. **`getEventPresentation(code string) string`**
   - –ú–∞–ø–ø–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫
   - –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ C# –≤–µ—Ä—Å–∏–∏ (80+ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π)
   - –í–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: Access, Data, InfoBase, Job, Session, Transaction, User, –∏ —Ç.–¥.

---

### 4. –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ hex

**–§—É–Ω–∫—Ü–∏—è:** `parseTransactionFromHex(s string)`

**–õ–æ–≥–∏–∫–∞:**
- –ü–∞—Ä—Å–∏—Ç `{transaction_date_hex, transaction_number_hex}`
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç hex –≤ int64
- –î–ª—è –¥–∞—Ç—ã: –¥–µ–ª–∏—Ç –Ω–∞ 10000 (–∫–∞–∫ –≤ C#: `AddSeconds(value / 10000)`)
- –î–ª—è –Ω–æ–º–µ—Ä–∞: –ø—Ä–æ—Å—Ç–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç hex –≤ int64

---

### 5. –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ —Å–ª–æ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–§—É–Ω–∫—Ü–∏—è:** `parseDataField(s string)`

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã:**
- `R` - Reference (—Å—Å—ã–ª–∫–∞)
- `U` - Undefined (–Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ)
- `S` - String (—Å—Ç—Ä–æ–∫–∞)
- `B` - Boolean (–±—É–ª–µ–≤–æ)
- `P` - Complex data (—Å–ª–æ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–ª—è —Ç–∏–ø–∞ `P`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –≤ C# –≤–µ—Ä—Å–∏–∏: "Item N: value"

---

## üìã –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LGF —Ñ–∞–π–ª–æ–º
- –ü–æ–ª—è `user_id`, `computer_id`, `application`, `event_id`, `metadata`, `server`, `ports` —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ –∫–æ–¥—ã
- –ù—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∏—Ö —á–µ—Ä–µ–∑ LGF —Ñ–∞–π–ª (–∫–∞–∫ –≤ C# –≤–µ—Ä—Å–∏–∏ —á–µ—Ä–µ–∑ `_lgfReader.GetObjectValue()`)
- **–ü–æ–∫–∞:** –∑–Ω–∞—á–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å, –º–∞–ø–ø–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ —Å–æ–±—ã—Ç–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –∫–æ–¥–∞–º

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –ø–æ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –º–∞–ø–ø–∏–Ω–≥–∞ –∑–Ω–∞—á–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É edge cases (–ø—É—Å—Ç—ã–µ –ø–æ–ª—è, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –í–æ–∑–º–æ–∂–Ω–æ, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ —Å–æ–±—ã—Ç–∏–π (—Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è map)
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–ª–æ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üîç –û—Ç–ª–∏—á–∏—è –æ—Ç C# –≤–µ—Ä—Å–∏–∏

### –ß—Ç–æ –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–ø–æ–∫–∞):
1. **LGF Reader –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –≤ C# –≤–µ—Ä—Å–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `_lgfReader.GetObjectValue()`
2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ** - –≤ C# –≤–µ—Ä—Å–∏–∏ –µ—Å—Ç—å `_skipEventsBeforeDate`
3. **FileSystemWatcher** - –≤ C# –≤–µ—Ä—Å–∏–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ª—É—á—à–µ:
1. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏** - Go –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ—Å—É—Ä—Å–∞–º–∏ —á–µ—Ä–µ–∑ defer
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –±–æ–ª–µ–µ —è–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ Go
3. **–ù–µ—Ç race conditions** - Go goroutines –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ —á–µ–º C# threads

---

## üìö –°—Å—ã–ª–∫–∏

- –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ C#: https://github.com/akpaevj/OneSTools.EventLog
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º C# –≤–µ—Ä—Å–∏–∏: `docs/analysis/onestools-eventlog-issues.md`
- –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: `docs/specs/log-service.spec.md`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–∞—Ä—Å–µ—Ä –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

